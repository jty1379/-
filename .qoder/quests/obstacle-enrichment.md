# 障碍物丰富化设计文档

## 1. 需求概述

为增强游戏趣味性和挑战性，需要对现有的障碍物系统进行扩展，主要目标是实现不同高度的仙人掌生成，同时确保小恐龙能够通过跳跃越过所有障碍物。

## 2. 当前分析

### 2.1 现有障碍物实现

当前游戏中有两种障碍物：
1. 仙人掌(Cactus)：固定尺寸20x40像素，位置固定在地面高度(340-40=300)
2. 鸟类(Bird)：固定尺寸30x20像素，有两种飞行高度(320和280)

### 2.2 地面高度逻辑

从代码分析得出：
- 游戏地面基准线位于y=340
- 小恐龙站立时高度为50像素，因此站立时y坐标为340-50=290
- 小恐龙蹲下时高度为30像素，因此蹲下时y坐标为340-30=310
- 仙人掌当前生成位置为y=300(340-40)，高度为40像素

### 2.3 跳跃机制

- 小恐龙跳跃初速度为-15
- 重力加速度为1
- 最大跳跃高度约为112像素(基于物理公式计算)
- 因此小恐龙可以跳过的最大障碍物高度约为112像素

## 3. 设计方案

### 3.1 可变高度仙人掌设计

引入随机高度的仙人掌，但需确保以下约束条件：

1. 最小高度：20像素(保持基本识别性)
2. 最大高度：100像素(确保小恐龙可以跳过)
3. 高度变化步长：10像素(简化实现)

### 3.2 生成策略

修改`generateObstacle()`函数中的仙人掌创建逻辑：
- 保留原有的随机类型选择机制
- 在创建仙人掌时增加高度随机化逻辑
- 确保仙人掌底部始终贴地(即y坐标根据高度动态调整)

### 3.3 碰撞检测优化

现有碰撞检测基于矩形包围盒，对于高度不同的仙人掌仍然适用，无需修改。

## 4. 实施细节

### 4.1 Cactus 类修改

新增构造函数参数支持指定高度：
```cpp
Cactus::Cactus(float x, float y, float height) : Obstacle(x, y, 20, height) {}
```

修改原有构造函数以保持兼容性：
```cpp
Cactus::Cactus(float x, float y) : Obstacle(x, y, 20, 40) {}
```

### 4.2 障碍物生成逻辑修改

在`generateObstacle()`函数中：
1. 当决定生成仙人掌时，随机确定其高度(20-100像素)
2. 根据高度重新计算y坐标，确保底部与地面贴合
3. 使用新的构造函数创建仙人掌对象

### 4.3 兼容性考虑

- 保留原有构造函数以确保其他代码不受影响
- 不改变鸟类或其他障碍物的生成逻辑
- 维持现有的碰撞检测机制

## 5. 验证标准

1. 仙人掌能够以不同高度正确显示
2. 所有高度的仙人掌都能被小恐龙跳跃越过
3. 碰撞检测准确无误
4. 游戏性能未受影响
5. 其他障碍物行为保持不变4. 游戏性能未受影响
5. 其他障碍物行为保持不变